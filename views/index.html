<!doctype html>
<html lang="en">
 
<head>
	<meta charset="UTF-8">
	<meta charset="utf-8"> 
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
	<title>SDemo</title>
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons"
	/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
	
	<link href="css/bootstrap.min.css" rel="stylesheet" />
	<link href="css/material-bootstrap-wizard.css" rel="stylesheet" />
	<link href="css/sdemo.css" rel="stylesheet" />
</head>

<body class="bg-light"> 
	<div class="container">
		<div class="row">
			<div class="col-sm-12 col-sm-offset-2">
				<div class="wizard-container">
					<div class="card wizard-card" data-color="green">
						<form action="" method="">
							<div class="wizard-header">
								<h3 class="wizard-title">Анкета кандидата</h3>
							</div>

							<div class="wizard-navigation">
								<ul>
									<li><a href="#tabFirst" data-toggle="tab">О себе</a></li>
									<li><a href="#tabSecond" data-toggle="tab">Данные документов</a></li>
								</ul>
							</div>

							<div class="tab-content">
								<div class="tab-pane" id="tabFirst">
									<div class="alert alert-warning text-left" role="alert">Вы можете заполнить часть анкеты автоматически, загрузив скан документа или сфотографировав его (если эта страница открыта
											на мобильном устройстве), либо ввести данные документов вручную на следующем шаге.</div>
									<div class="row">
										<div class="col-sm-4">
											<label class="btn btn-primary btn-block rndbtn">
												<span id="btn_pass"><i class='fa fa-upload'></i>&nbsp;&nbsp;Паспорт</span>
												<input id="filePASS" type="file" onchange="onChooseFile('PASS')" style="display: none;"></input>
											</label>
										</div>
										<div class="col-sm-4">
											<label class="btn btn-dark btn-block rndbtn" disabled>
													<i class='fa fa-upload'></i>&nbsp;&nbsp;СНИЛС
												<input id="fileSNILS" type="file" onchange="onChooseFile('SNILS')" style="display: none;"></input>
											</label>
										</div>
										<div class="col-sm-4">
											<label class="btn btn-dark btn-block rndbtn" disabled>
													<i class='fa fa-upload'></i>&nbsp;&nbsp;ИНН
												<input id="fileINN" type="file" onchange="onChooseFile('INN')" style="display: none;"></input>
											</label>
										</div>
									</div>
									<br/>
									<div class="form-group label-static">
										<label class="control-label">Email
											<span class="text-danger">
												<sup>*</sup>
											</span>
										</label>
										<input id="email" type="email" class="form-control">
									</div>
									<div class="form-group label-static">
										<label class="control-label">Телефон
											<span class="text-danger">
												<sup>*</sup>
											</span>
										</label>
										<input id="phone" type="text" class="form-control">
									</div>
									<div class="form-group label-static">
										<label class="control-label">
											<span>Образование</span>
										</label>
										<textarea id="family" class="form-control"></textarea>	
									</div>
									<div class="form-group label-static">
										<label class="control-label">
											<span>Данные о родственниках</span>
										</label>
										<textarea id="family" class="form-control"></textarea>	
									</div>
								</div>
								<div class="tab-pane" id="tabSecond">
									<div class="alert alert-warning text-left" role="alert">Проверьте и дозаполните данные документов. Если на предыдущем шаге вы загрузили изображения документов, часть полей уже предзаполнена.</div>
									<br/>
									<div class="form-group label-static">
										<label class="control-label">Фамилия
											<span class="text-danger">
												<sup>*</sup>
											</span>
										</label>
										<input id="lastname" type="text" class="form-control">
									</div>
									<div class="form-group label-static">
										<label class="control-label">Имя
											<span class="text-danger">
												<sup>*</sup>
											</span>
										</label>
										<input id="firstname" type="text" class="form-control">
									</div>
									<div class="form-group label-static">
										<label class="control-label">Отчество
											<span class="text-danger">
												<sup>*</sup>
											</span>
										</label>
										<input id="midname" type="text" class="form-control">
									</div>
									<div class="form-group label-static">
										<label class="control-label">Дата рождения
											<span class="text-danger">
												<sup>*</sup>
											</span>
										</label>
										<input id="birthdate" type="date" class="form-control" data-date-format="DD.MM.YYYY">
									</div>
									<div class="row form-group">
										<div class="col-sm-2 form-group label-static">
											<label class="control-label">Серия</label>
											<input id="pass_seria" type="text" class="form-control">
										</div>
										<div class="col-sm-8 form-group label-static">
											<label class="control-label">Номер паспорта</label>
											<input id="pass_number" type="text" class="form-control">
										</div>
										<div class="col-sm-2 form-group label-static">
												<label class="control-label">Дата выдачи</label>
												<input id="pass_date" type="date" class="form-control" data-date-format="DD.MM.YYYY">
										</div>
									</div>
									<div class="form-group label-static">
										<label class="control-label">Выдан</label>
										<input id="pass_given" type="text" class="form-control">
									</div>
									<div class="form-group label-static">
										<label class="control-label">СНИЛС</label>
										<input id="snils" type="text" class="form-control">
									</div>
									<div class="form-group label-static">
										<label class="control-label">ИНН</label>
										<input id="inn" type="text" class="form-control">
									</div>
								</div>
							</div>

							<div class="wizard-footer">
								<div class="pull-right">
									<input type='button' class='btn btn-next btn-fill btn-success btn-wd' name='next' value='Дальше' />
									<input type='button' class='btn btn-finish btn-fill btn-success btn-wd' name='finish' value='Завершить' />
								</div>

								<div class="pull-left">
									<input type='button' class='btn btn-previous btn-fill btn-default btn-wd' name='previous' value='Назад' />
								</div>
								<div class="clearfix"></div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="container col-sm-6 col-md-6 col-lg-6">
		<div class="bg-white row">
			<div class="center-block col-sm-12 col-md-12 col-lg-12">
			</div>
			</form>
		</div>
	</div>
</body>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
 crossorigin="anonymous"></script>
<script src="js/jquery.bootstrap.js" type="text/javascript"></script>
<script src="js/material-bootstrap-wizard.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.js"></script>
<script>
	function onChooseFile(type) {
		var file = $("#file" + type)[0].files[0];
		if (file) {
			var reader = new FileReader();
			reader.onloadend = function (evt) {
			//	$("#img")[0].src = evt.target.result;
				$("#btn_pass").html("<i class='fa fa-spinner fa-spin '></i>&nbsp;Распознавание...");
				ocr(evt.target.result);
			}
			reader.readAsDataURL(file, "UTF-8");
		}
	}

	function ocr(image) {
		$.ajax({
			url: '/ocr',
			type: "POST",
			data: { image: image },
			dataType: "json",
			success: function (data, status, xhttp) {
				set_val("#firstname", data.firstName);
				set_val("#lastname", data.lastName);
				set_val("#midname", data.midName);
				set_val("#birthdate", data.birthDate);
				set_val("#pass_seria", data.passSeria);
				set_val("#pass_number", data.passNumber);
				set_val("#pass_date", data.passDate);
				set_val("#pass_given", data.passGiven);
				$("#btn_pass").html("Паспорт");
			},
			error: function (xhr, ajaxOptions, thrownError) {
				$("#btn_pass").html("<i class='fa fa-upload'></i>&nbsp;&nbsp;Паспорт");
				alert(xhr.status);
				alert(thrownError);
			},
			timeout: 120000
		});
	}

	function set_val(id, val) {
		$(id).focus().val(val);
		$(id).parent('.mdl-textfield').removeClass('is-invalid').addClass('is-dirty')
	}
</script>

</html>
